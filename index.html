<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARXADS CRM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { background-color: #000; color: #fff; font-family: 'Inter', sans-serif; margin: 0; overflow-x: hidden; }
        .text-gold { color: #FFD700; }
        .btn-gold { background-color: #FFD700; color: #000; font-weight: 900; transition: 0.3s; cursor: pointer; border: none; }
        .input-dark { background: #111; border: 1px solid #222; color: #fff; padding: 12px; border-radius: 8px; outline: none; font-size: 13px; width: 100%; }
        
        #mainDashboard { display: none; min-height: 100vh; }
        aside { width: 260px; background: #050505; border-right: 1px solid #111; display: flex; flex-direction: column; flex-shrink: 0; transition: 0.3s; }
        aside.hidden { margin-left: -260px; pointer-events: none; }

        .menu-item { cursor: pointer; border-left: 3px solid transparent; transition: 0.3s; color: #555; font-size: 10px; font-weight: bold; text-transform: uppercase; padding: 18px 25px; }
        .menu-item.active { border-left: 3px solid #FFD700; background: #0a0a0a; color: #FFD700; }

        #cotaPopup { 
            display: none; position: absolute; top: 50%; left: 50%; 
            transform: translate(-50%, -50%); z-index: 500; 
            background: rgba(0,0,0,0.98); border: 3px solid #FFD700; 
            padding: 40px; border-radius: 20px; text-align: center; 
            box-shadow: 0 0 100px rgba(255, 215, 0, 0.4); width: 450px; 
            animation: popShow 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popShow { from { transform: translate(-50%, -50%) scale(0.5); opacity: 0; } to { transform: translate(-50%, -50%) scale(1); opacity: 1; } }

        .kanban-col { background: #0a0a0a; border: 1px solid #111; border-radius: 15px; min-width: 280px; height: calc(100vh - 150px); overflow-y: auto; }
        .lead-card { background: #151515; border: 1px solid #222; padding: 15px; border-radius: 12px; margin-bottom: 12px; }
        #modalAdmin, #modalFechamento { display: none; position: fixed; inset: 0; z-index: 1000; align-items: center; justify-content: center; background: rgba(0,0,0,0.9); }
    </style>
</head>
<body>

    <div id="vendorLogin" class="h-screen flex items-center justify-center bg-black z-[5000] fixed inset-0">
        <div class="bg-zinc-950 p-10 rounded-[40px] border border-zinc-900 w-full max-w-sm text-center">
            <h1 class="text-4xl font-black text-gold italic mb-8 uppercase tracking-tighter">ARXADS CRM</h1>
            <div class="space-y-4 flex flex-col text-left">
                <input type="text" id="loginUser" class="input-dark" placeholder="Usu√°rio">
                <input type="password" id="loginPass" class="input-dark" placeholder="Senha">
                <button onclick="validaLogin()" class="btn-gold py-4 rounded-2xl mt-4 uppercase text-xs">Acessar Sistema</button>
            </div>
        </div>
    </div>

    <div id="mainDashboard" class="flex">
        <aside id="sidebarMenu">
            <div class="p-8 text-gold font-black italic text-xl tracking-tighter">ARXADS CRM</div>
            <nav class="flex flex-col flex-1">
                <div onclick="showSection('crm-list')" id="nav-crm-list" class="menu-item active">üìÖ Agendamentos</div>
                <div onclick="showSection('pipeline')" id="nav-pipeline" class="menu-item">üìä Funil (CRM)</div>
                <div onclick="showSection('analytics')" id="nav-analytics" class="menu-item">üìà Analytics (BI)</div>
                <div onclick="showSection('ranking')" id="nav-ranking" class="menu-item">üèÜ Rankings</div>
                <div onclick="abrirModoReuniao()" class="menu-item bg-zinc-900 text-white mt-auto">üé¨ MODO REUNI√ÉO</div>
            </nav>
            <div class="p-4 border-t border-zinc-900">
                <button onclick="showAdminModal()" class="text-[9px] text-zinc-600 uppercase font-bold hover:text-gold w-full text-left italic">‚öôÔ∏è Gest√£o & PDF</button>
            </div>
        </aside>

        <main class="flex-1 relative overflow-hidden bg-black flex flex-col">
            <section id="sec-crm-list" class="p-10 overflow-y-auto h-full">
                <h1 class="text-3xl font-black italic uppercase text-gold mb-8">Cadastrar Lead</h1>
                <div class="bg-zinc-950 p-8 rounded-[30px] border border-zinc-900 grid grid-cols-4 gap-4 mb-8">
                    <input type="text" id="leadName" placeholder="Cliente" class="input-dark">
                    <input type="text" id="leadNicho" placeholder="Nicho" class="input-dark">
                    <input type="text" id="leadProt" placeholder="Protocolo" class="input-dark font-mono">
                    <input type="datetime-local" id="leadDate" class="input-dark">
                    <select id="sdrSelect" class="input-dark sdr-list-source"></select>
                    <select id="closerSelect" class="input-dark closer-list-source"></select>
                    <select id="cotaType" class="input-dark col-span-2">
                        <option value="Cota Bonificada 2/5 restantes">Cota Bonificada 2/5 restantes</option>
                        <option value="Cota Bonificada 1/5 restantes">Cota Bonificada 1/5 restantes</option>
                    </select>
                    <button onclick="salvarLead()" class="btn-gold rounded-xl font-black uppercase text-sm py-4 col-span-4">Agendar Agora</button>
                </div>
                <div class="rounded-2xl border border-zinc-900 overflow-hidden">
                    <table class="w-full text-left text-xs">
                        <thead class="bg-zinc-900 text-zinc-500 uppercase text-[9px]">
                            <tr><th class="p-4">Data</th><th class="p-4">Cliente</th><th class="p-4">Funil</th><th class="p-4">Reuni√£o</th><th class="p-4">A√ß√£o</th></tr>
                        </thead>
                        <tbody id="crmBody"></tbody>
                    </table>
                </div>
            </section>

            <section id="sec-analytics" class="hidden p-10 h-full overflow-y-auto">
                <div class="grid grid-cols-2 gap-8">
                    <div class="bg-zinc-950 p-6 rounded-3xl border border-zinc-900 text-center">
                        <h3 class="text-[10px] text-zinc-500 uppercase mb-4">Volume de Reuni√µes</h3>
                        <canvas id="chartReuniao"></canvas>
                    </div>
                    <div class="bg-zinc-950 p-6 rounded-3xl border border-zinc-900 text-center">
                        <h3 class="text-[10px] text-zinc-500 uppercase mb-4">Taxa de Convers√£o</h3>
                        <canvas id="chartVendas"></canvas>
                    </div>
                </div>
            </section>

            <section id="sec-apresentacao_real" class="hidden flex-1 flex flex-col bg-black relative">
                <div class="p-4 bg-zinc-950 border-b border-zinc-900 flex justify-between items-center px-10">
                    <button onclick="changePage(-1)" class="text-gold text-4xl">‚óÄ</button>
                    <div class="flex flex-col items-center">
                        <span class="text-gold font-black text-sm" id="activeClientName">---</span>
                        <span class="text-[9px] uppercase text-zinc-600">Slide <span id="pageNumDisplay">1</span></span>
                    </div>
                    <button onclick="changePage(1)" class="text-gold text-4xl">‚ñ∂</button>
                    <button onclick="abrirFechamento()" class="bg-white text-black px-10 py-3 rounded-full font-black text-xs uppercase hover:scale-105 transition">Encerrar e Fechar Venda</button>
                </div>
                
                <div class="flex-1 overflow-hidden p-4 flex justify-center items-center bg-black relative" id="pdfContainer">
                    <canvas id="pdfCanvas" class="shadow-2xl shadow-gold/5"></canvas>
                    
                    <div id="cotaPopup">
                        <h3 class="text-zinc-500 text-[10px] uppercase font-bold mb-2 tracking-[0.3em]">Cota Bonificada Liberada</h3>
                        <h2 id="cotaTexto" class="text-3xl font-black text-gold italic uppercase mb-8 leading-tight"></h2>
                        <button onclick="document.getElementById('cotaPopup').style.display='none'" class="btn-gold px-12 py-4 rounded-full text-xs uppercase">Aplicar Benef√≠cio Agora</button>
                    </div>
                </div>
            </section>

            <section id="sec-pipeline" class="hidden p-8 h-full"><div class="flex gap-4 overflow-x-auto h-full" id="pipelineContainer"></div></section>
            <section id="sec-ranking" class="hidden p-10 h-full overflow-y-auto"><div id="rankingClosers" class="mb-10"></div><div id="rankingSDRs"></div></section>
        </main>
    </div>

    <div id="modalAdmin">
        <div class="bg-zinc-950 p-10 rounded-[40px] border border-zinc-800 w-full max-w-lg">
            <div id="adminAuth">
                <h2 class="text-gold font-black mb-6 uppercase text-center">Painel Master</h2>
                <input type="password" id="adminPassInput" placeholder="Senha Master" class="input-dark text-center mb-4">
                <button onclick="authAdmin()" class="btn-gold w-full py-4 rounded-xl text-xs uppercase">Acessar</button>
                <button onclick="hideAdminModal()" class="w-full text-zinc-600 text-[10px] mt-4 uppercase text-center">Voltar</button>
            </div>
            <div id="adminPanel" class="hidden space-y-6">
                <h3 class="text-gold font-black text-xs uppercase italic">1. Gest√£o do Time</h3>
                <div class="grid grid-cols-2 gap-2">
                    <input type="text" id="newStaffName" placeholder="Nome" class="input-dark">
                    <input type="text" id="newStaffUser" placeholder="Login" class="input-dark">
                    <input type="password" id="newStaffPass" placeholder="Senha" class="input-dark">
                    <select id="newStaffRole" class="input-dark"><option value="Closer">Closer</option><option value="SDR">SDR</option></select>
                </div>
                <button onclick="cadastrarEquipe()" class="btn-gold w-full py-3 rounded-lg text-[10px] uppercase">Registrar Membro</button>
                <div id="staffList" class="max-h-32 overflow-y-auto bg-black p-3 rounded-xl border border-zinc-900 text-[10px]"></div>
                <hr class="border-zinc-900">
                <h3 class="text-gold font-black text-xs uppercase italic">2. Material de Vendas</h3>
                <input type="file" id="pdfInput" accept="application/pdf" class="hidden" onchange="savePdf(this.files[0])">
                <label for="pdfInput" class="btn-gold block text-center py-4 rounded-xl text-[10px] uppercase cursor-pointer">Atualizar PDF da Apresenta√ß√£o</label>
                <button onclick="hideAdminModal()" class="w-full text-zinc-600 text-[10px] uppercase text-center mt-4">Fechar Painel</button>
            </div>
        </div>
    </div>

    <div id="modalFechamento">
        <div class="bg-zinc-950 p-10 rounded-[40px] border border-zinc-800 w-full max-w-sm text-center">
            <h2 class="text-gold font-black text-2xl mb-8 uppercase italic">Fechar Contrato</h2>
            <div class="space-y-4">
                <input type="number" id="f_setup" placeholder="Setup R$" class="input-dark">
                <input type="number" id="f_mensal" placeholder="Mensal R$" class="input-dark">
                <button onclick="salvarResultado('FECHOU')" class="w-full bg-green-600 py-6 rounded-2xl font-black uppercase text-sm">Venda Realizada! ‚úÖ</button>
                <button onclick="salvarResultado('PERDIDO')" class="w-full bg-zinc-900 py-3 rounded-2xl font-bold uppercase text-[10px] text-zinc-500">No-Show / Perdido</button>
            </div>
        </div>
    </div>

    <div id="meetingLogin" class="h-screen fixed inset-0 flex flex-col items-center justify-center bg-black z-[2000] hidden">
        <div class="bg-zinc-950 p-12 rounded-[40px] border border-zinc-800 w-full max-w-sm text-center">
            <h2 class="text-gold font-black text-2xl uppercase mb-10 tracking-tighter italic">Reuni√£o ARXADS CRM</h2>
            <input type="text" id="mProtocol" placeholder="PROTOCOLO" class="bg-zinc-900 border border-zinc-800 w-full text-center text-4xl font-mono py-6 rounded-2xl mb-8 text-gold outline-none">
            <button onclick="loginReuniao()" class="btn-gold w-full py-6 rounded-2xl text-xl uppercase italic">Come√ßar Agora</button>
            <button onclick="voltarAoPainel()" class="text-zinc-600 text-[10px] mt-10 block w-full uppercase underline italic">Sair do Modo Reuni√£o</button>
        </div>
    </div>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';
        let pdfDoc = null, pageNum = 1, activeLead = null, db = null, charts = { c1: null, c2: null };
        const SENHA_MASTER = "admin777";

        // DB E PERSIST√äNCIA MANTIDOS
        const request = indexedDB.open("ArxAdsDB_V18", 1);
        request.onupgradeneeded = e => e.target.result.createObjectStore("files");
        request.onsuccess = e => { db = e.target.result; checkSavedPdf(); };

        function checkSavedPdf() {
            const tx = db.transaction("files", "readonly");
            const get = tx.objectStore("files").get("presentation");
            get.onsuccess = async () => { if(get.result) pdfDoc = await pdfjsLib.getDocument({data: get.result}).promise; };
        }

        function savePdf(file) {
            const reader = new FileReader();
            reader.onload = e => {
                const tx = db.transaction("files", "readwrite");
                tx.objectStore("files").put(e.target.result, "presentation");
                tx.oncomplete = () => { alert("Apresenta√ß√£o Atualizada!"); checkSavedPdf(); };
            };
            reader.readAsArrayBuffer(file);
        }

        function showSection(id) {
            const sidebar = document.getElementById('sidebarMenu');
            document.querySelectorAll('main section').forEach(s => s.classList.add('hidden'));
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            if(id === 'apresentacao_real') sidebar.classList.add('hidden');
            else sidebar.classList.remove('hidden');
            document.getElementById('sec-' + id).classList.remove('hidden');
            if(document.getElementById('nav-' + id)) document.getElementById('nav-' + id).classList.add('active');
            if(id === 'analytics') renderAnalytics();
            if(id === 'pipeline') renderPipeline();
            if(id === 'ranking') renderRanking();
        }

        // --- FUN√á√ÉO ALTERADA PARA AUTO-AJUSTE DE ZOOM ---
        async function renderPage(num) {
            if(!pdfDoc) return;
            const page = await pdfDoc.getPage(num);
            const canvas = document.getElementById('pdfCanvas');
            const container = document.getElementById('pdfContainer');
            
            // Calcula a escala para caber na tela (Fit to Screen)
            const unscaledViewport = page.getViewport({ scale: 1 });
            const padding = 60; // Margem de seguran√ßa
            const scaleWidth = (container.clientWidth - padding) / unscaledViewport.width;
            const scaleHeight = (container.clientHeight - padding) / unscaledViewport.height;
            const finalScale = Math.min(scaleWidth, scaleHeight);

            const viewport = page.getViewport({ scale: finalScale });
            canvas.height = viewport.height;
            canvas.width = viewport.width;
            
            await page.render({ canvasContext: canvas.getContext('2d'), viewport }).promise;
            document.getElementById('pageNumDisplay').innerText = num;

            if(num === 14 && activeLead) {
                document.getElementById('cotaTexto').innerText = activeLead.cota;
                document.getElementById('cotaPopup').style.display = 'block';
            } else {
                document.getElementById('cotaPopup').style.display = 'none';
            }
        }

        function changePage(d) { let n = pageNum + d; if(n > 0 && n <= pdfDoc.numPages) { pageNum = n; renderPage(n); } }

        // RESTANTE DO C√ìDIGO MANTIDO IGUAL (CRM, LOGIN, ETC)
        function validaLogin() {
            const u = document.getElementById('loginUser').value, p = document.getElementById('loginPass').value;
            const eq = JSON.parse(localStorage.getItem('arx_equipe') || '[]');
            if((u === "admin" && p === SENHA_MASTER) || eq.find(m => m.user === u && m.pass === p)) {
                document.getElementById('vendorLogin').style.display = 'none';
                document.getElementById('mainDashboard').style.display = 'flex';
                updateSelects(); renderCRM();
            } else alert("Acesso Negado!");
        }

        function salvarLead() {
            const l = {
                id: Date.now(),
                lead: document.getElementById('leadName').value,
                nicho: document.getElementById('leadNicho').value,
                protocolo: document.getElementById('leadProt').value,
                data: document.getElementById('leadDate').value,
                sdr: document.getElementById('sdrSelect').value,
                closer: document.getElementById('closerSelect').value,
                cota: document.getElementById('cotaType').value,
                status: 'AGENDADO', statusReuniao: 'Pendente', setup: 0, mensal: 0
            };
            if(!l.lead || !l.protocolo) return alert("Preencha tudo!");
            const leads = JSON.parse(localStorage.getItem('arx_leads') || '[]');
            leads.unshift(l);
            localStorage.setItem('arx_leads', JSON.stringify(leads));
            renderCRM();
        }

        function renderCRM() {
            const leads = JSON.parse(localStorage.getItem('arx_leads') || '[]');
            document.getElementById('crmBody').innerHTML = leads.map(l => `
                <tr class="border-b border-zinc-900">
                    <td class="p-4 text-zinc-600 font-mono text-[10px]">${l.data.replace('T', ' ')}</td>
                    <td class="p-4 font-black uppercase text-white">${l.lead}<br><span class="text-[8px] text-gold font-mono">#${l.protocolo}</span></td>
                    <td class="p-4">
                        <select onchange="updateLeadField(${l.id}, 'status', this.value)" class="bg-black text-[10px] border border-zinc-800 rounded p-1">
                            <option value="AGENDADO" ${l.status==='AGENDADO'?'selected':''}>AGENDADO</option>
                            <option value="FOLLOWUP" ${l.status==='FOLLOWUP'?'selected':''}>FOLLOWUP</option>
                            <option value="FECHOU" ${l.status==='FECHOU'?'selected':''}>FECHOU ‚úÖ</option>
                            <option value="PERDIDO" ${l.status==='PERDIDO'?'selected':''}>PERDIDO ‚ùå</option>
                        </select>
                    </td>
                    <td class="p-4"><span class="bg-zinc-900 px-2 py-1 rounded text-[10px] text-zinc-400">${l.statusReuniao}</span></td>
                    <td class="p-4"><button onclick="deleteLead(${l.id})" class="text-red-900 text-[9px] font-bold">EXCLUIR</button></td>
                </tr>`).join('');
        }

        function updateLeadField(id, f, v) {
            const leads = JSON.parse(localStorage.getItem('arx_leads') || '[]');
            const idx = leads.findIndex(l => l.id === id);
            leads[idx][f] = v;
            localStorage.setItem('arx_leads', JSON.stringify(leads));
            renderCRM();
        }

        function deleteLead(id) { if(confirm("Deletar Lead?")) { let leads = JSON.parse(localStorage.getItem('arx_leads') || '[]'); leads = leads.filter(l => l.id !== id); localStorage.setItem('arx_leads', JSON.stringify(leads)); renderCRM(); } }

        function renderAnalytics() {
            const leads = JSON.parse(localStorage.getItem('arx_leads') || '[]');
            const r = leads.filter(l => l.statusReuniao === 'Realizada').length;
            const n = leads.filter(l => l.statusReuniao === 'No-Show').length;
            const f = leads.filter(l => l.status === 'FECHOU').length;
            if(charts.c1) charts.c1.destroy(); if(charts.c2) charts.c2.destroy();
            charts.c1 = new Chart(document.getElementById('chartReuniao'), { type: 'bar', data: { labels: ['Presen√ßa', 'No-Show'], datasets: [{ data: [r, n], backgroundColor: ['#FFD700', '#222'] }] } });
            charts.c2 = new Chart(document.getElementById('chartVendas'), { type: 'doughnut', data: { labels: ['Vendas', 'Restante'], datasets: [{ data: [f, leads.length - f], backgroundColor: ['#22c55e', '#111'], borderColor: '#000' }] } });
        }

        function loginReuniao() {
            const prot = document.getElementById('mProtocol').value;
            const leads = JSON.parse(localStorage.getItem('arx_leads') || '[]');
            activeLead = leads.find(l => l.protocolo === prot);
            if(activeLead) {
                document.getElementById('activeClientName').innerText = activeLead.lead;
                document.getElementById('meetingLogin').classList.add('hidden');
                document.getElementById('mainDashboard').style.display = 'flex';
                showSection('apresentacao_real');
                pageNum = 1; setTimeout(() => renderPage(1), 100);
            } else alert("Lead n√£o encontrado!");
        }

        function salvarResultado(st) {
            const leads = JSON.parse(localStorage.getItem('arx_leads') || '[]');
            const idx = leads.findIndex(l => l.id === activeLead.id);
            leads[idx].status = st;
            leads[idx].statusReuniao = 'Realizada';
            leads[idx].setup = document.getElementById('f_setup').value || 0;
            leads[idx].mensal = document.getElementById('f_mensal').value || 0;
            localStorage.setItem('arx_leads', JSON.stringify(leads));
            document.getElementById('modalFechamento').style.display = 'none';
            if(st === 'FECHOU') confetti({ particleCount: 200, colors: ['#FFD700', '#fff'] });
            voltarAoPainel();
        }

        function cadastrarEquipe() {
            const n = document.getElementById('newStaffName').value, u = document.getElementById('newStaffUser').value, p = document.getElementById('newStaffPass').value, r = document.getElementById('newStaffRole').value;
            if(!n || !u || !p) return;
            const eq = JSON.parse(localStorage.getItem('arx_equipe') || '[]');
            eq.push({ name: n, user: u, pass: p, role: r });
            localStorage.setItem('arx_equipe', JSON.stringify(eq));
            renderStaffList(); updateSelects();
        }

        function renderStaffList() {
            const eq = JSON.parse(localStorage.getItem('arx_equipe') || '[]');
            document.getElementById('staffList').innerHTML = eq.map(e => `<div class="py-1 border-b border-zinc-900">${e.role}: ${e.name}</div>`).join('');
        }

        function updateSelects() {
            const eq = JSON.parse(localStorage.getItem('arx_equipe') || '[]');
            const closers = eq.filter(e => e.role === 'Closer').map(e => `<option value="${e.name}">${e.name}</option>`).join('');
            const sdrs = eq.filter(e => e.role === 'SDR').map(e => `<option value="${e.name}">${e.name}</option>`).join('');
            document.querySelectorAll('.closer-list-source').forEach(s => s.innerHTML = closers || '<option>Sem Closers</option>');
            document.querySelectorAll('.sdr-list-source').forEach(s => s.innerHTML = sdrs || '<option>Sem SDRs</option>');
        }

        function authAdmin() { if(document.getElementById('adminPassInput').value === SENHA_MASTER) { document.getElementById('adminAuth').classList.add('hidden'); document.getElementById('adminPanel').classList.remove('hidden'); renderStaffList(); } }
        function showAdminModal() { document.getElementById('modalAdmin').style.display = 'flex'; }
        function hideAdminModal() { document.getElementById('modalAdmin').style.display = 'none'; }
        function abrirModoReuniao() { document.getElementById('mainDashboard').style.display = 'none'; document.getElementById('meetingLogin').classList.remove('hidden'); }
        function voltarAoPainel() { document.getElementById('meetingLogin').classList.add('hidden'); document.getElementById('mainDashboard').style.display = 'flex'; showSection('crm-list'); }
        function abrirFechamento() { document.getElementById('modalFechamento').style.display = 'flex'; }

        function renderRanking() {
            const leads = JSON.parse(localStorage.getItem('arx_leads') || '[]');
            const cSt = {}; const sSt = {};
            leads.forEach(l => {
                if(l.status === 'FECHOU') cSt[l.closer] = (cSt[l.closer] || 0) + (parseFloat(l.setup) + parseFloat(l.mensal));
                sSt[l.sdr] = (sSt[l.sdr] || 0) + 1;
            });
            document.getElementById('rankingClosers').innerHTML = '<h2 class="text-gold font-black uppercase mb-4 text-xs italic">Closers: Ranking de Faturamento</h2>' + Object.entries(cSt).sort((a,b) => b[1]-a[1]).map(([n,v]) => `<div class="bg-zinc-900 p-5 rounded-xl flex justify-between mb-2 border-l-4 border-gold"><span>${n}</span><span class="text-gold font-bold">R$ ${v.toLocaleString()}</span></div>`).join('');
            document.getElementById('rankingSDRs').innerHTML = '<h2 class="text-gold font-black uppercase mb-4 text-xs italic">SDRs: Volume de Agendamentos</h2>' + Object.entries(sSt).sort((a,b) => b[1]-a[1]).map(([n,v]) => `<div class="bg-zinc-900 p-3 rounded-xl flex justify-between mb-2 border border-zinc-800"><span>${n}</span><span class="text-white font-bold">${v} Leads</span></div>`).join('');
        }

        function renderPipeline() {
            const leads = JSON.parse(localStorage.getItem('arx_leads') || '[]');
            const columns = ['AGENDADO', 'FOLLOWUP', 'FECHOU'];
            document.getElementById('pipelineContainer').innerHTML = columns.map(col => `
                <div class="kanban-col p-4 flex-1">
                    <h3 class="text-[10px] font-black uppercase text-zinc-600 mb-6 border-b border-zinc-900 pb-2">${col}</h3>
                    ${leads.filter(l => l.status === col).map(l => `
                        <div class="lead-card border-l-2 ${col==='FECHOU'?'border-green-500':'border-gold'}">
                            <div class="text-[8px] font-mono text-zinc-600 mb-2 uppercase flex justify-between"><span>#${l.protocolo}</span> <span>${l.nicho}</span></div>
                            <div class="font-black text-white uppercase text-sm">${l.lead}</div>
                        </div>`).join('')}
                </div>`).join('');
        }
        
        // Ajusta o PDF se a janela mudar de tamanho
        window.addEventListener('resize', () => {
            if(!document.getElementById('sec-apresentacao_real').classList.contains('hidden')) renderPage(pageNum);
        });
    </script>
</body>
</html>
