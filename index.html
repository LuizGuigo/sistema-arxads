<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARXADS OS | V14.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { background-color: #000; color: #fff; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        .text-gold { color: #FFD700; }
        .btn-gold { background-color: #FFD700; color: #000; font-weight: 900; transition: 0.3s; cursor: pointer; border: none; }
        .input-dark { background: #111; border: 1px solid #222; color: #fff; padding: 12px; border-radius: 8px; outline: none; font-size: 13px; width: 100%; }
        
        /* Mobile Fixes */
        #mainDashboard { display: none; flex-direction: column; height: 100vh; }
        @media (min-width: 768px) { #mainDashboard { flex-direction: row; } }

        aside { width: 100%; border-bottom: 1px solid #222; background: #0a0a0a; z-index: 50; }
        @media (min-width: 768px) { aside { width: 260px; height: 100vh; border-right: 1px solid #222; border-bottom: none; } }

        .menu-item { cursor: pointer; padding: 12px 20px; font-size: 11px; font-weight: bold; text-transform: uppercase; color: #555; border-left: 3px solid transparent; transition: 0.3s; }
        .menu-item.active { border-left: 3px solid #FFD700; background: #111; color: #FFD700; }
        
        main { flex: 1; overflow-y: auto; padding: 20px; }
        @media (min-width: 768px) { main { padding: 40px; } }

        .stat-card { background: #0a0a0a; border: 1px solid #111; padding: 20px; border-radius: 15px; text-align: center; }
        .table-container { overflow-x: auto; background: #0a0a0a; border-radius: 15px; border: 1px solid #111; }
        table { width: 100%; min-width: 600px; text-align: left; font-size: 12px; }
        
        #cotaPopup { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 500; background: #000; border: 2px solid #FFD700; padding: 30px; border-radius: 20px; width: 90%; max-width: 400px; text-align: center; }
    </style>
</head>
<body>

    <div id="vendorLogin" class="fixed inset-0 bg-black flex items-center justify-center z-[9999]">
        <div class="w-full max-w-xs text-center p-6">
            <h1 class="text-5xl font-black text-gold italic mb-8">ARXADS</h1>
            <input type="password" id="loginPass" class="input-dark text-center mb-4" placeholder="Senha Master">
            <button onclick="validaLogin()" class="btn-gold w-full py-4 rounded-xl uppercase">Entrar</button>
        </div>
    </div>

    <div id="mainDashboard">
        <aside class="flex flex-col">
            <div class="p-6 text-gold font-black italic text-xl hidden md:block">ARXADS OS</div>
            <nav class="flex md:flex-col overflow-x-auto md:overflow-visible">
                <div onclick="showSection('crm-list')" id="nav-crm-list" class="menu-item active flex-shrink-0">üìÖ Leads</div>
                <div onclick="showSection('analytics')" id="nav-analytics" class="menu-item flex-shrink-0">üìä Analytics</div>
                <div onclick="showSection('scripts')" id="nav-scripts" class="menu-item flex-shrink-0">üìù Scripts</div>
                <div onclick="showSection('ranking')" id="nav-ranking" class="menu-item flex-shrink-0">üèÜ Ranking</div>
                <div onclick="abrirModoReuniao()" class="menu-item bg-zinc-900 text-white flex-shrink-0">üé¨ Reuni√£o</div>
            </nav>
        </aside>

        <main>
            <section id="sec-crm-list">
                <h1 class="text-2xl font-black mb-6 uppercase italic text-gold">Agendamentos</h1>
                
                <div class="bg-zinc-950 p-6 rounded-2xl border border-zinc-900 mb-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                    <input type="text" id="leadName" placeholder="Cliente" class="input-dark">
                    <input type="text" id="leadNicho" placeholder="Nicho" class="input-dark">
                    <input type="text" id="leadProt" placeholder="Protocolo" class="input-dark">
                    <input type="datetime-local" id="leadDate" class="input-dark">
                    <select id="cotaType" class="input-dark sm:col-span-2">
                        <option value="Cota 1: 50% SETUP">Cota 1: 50% SETUP</option>
                        <option value="Cota 2: 50% TOTAL">Cota 2: 50% TOTAL</option>
                    </select>
                    <button onclick="salvarLead()" class="btn-gold sm:col-span-2 py-3 rounded-lg uppercase text-xs">Agendar</button>
                </div>

                <div class="table-container">
                    <table>
                        <thead class="bg-zinc-900 text-[10px] text-zinc-500 uppercase">
                            <tr>
                                <th class="p-4">Cliente</th>
                                <th class="p-4">Nicho</th>
                                <th class="p-4">Status Reuni√£o</th>
                                <th class="p-4">A√ß√£o</th>
                            </tr>
                        </thead>
                        <tbody id="crmBody"></tbody>
                    </table>
                </div>
            </section>

            <section id="sec-analytics" class="hidden">
                <h1 class="text-2xl font-black mb-8 uppercase italic text-gold">BI & Performance</h1>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
                    <div class="stat-card">
                        <p class="text-zinc-500 text-[10px] uppercase">Taxa de Convers√£o</p>
                        <h2 id="st-taxa" class="text-3xl font-black text-gold">0%</h2>
                    </div>
                    <div class="stat-card">
                        <p class="text-zinc-500 text-[10px] uppercase">Total Reuni√µes</p>
                        <h2 id="st-total" class="text-3xl font-black text-white">0</h2>
                    </div>
                    <div class="stat-card">
                        <p class="text-zinc-500 text-[10px] uppercase">Vendas Fechadas</p>
                        <h2 id="st-vendas" class="text-3xl font-black text-green-500">0</h2>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-zinc-950 p-6 rounded-2xl border border-zinc-900">
                        <h3 class="text-xs font-bold uppercase mb-4">Status das Reuni√µes</h3>
                        <canvas id="chartStatus"></canvas>
                    </div>
                    <div class="bg-zinc-950 p-6 rounded-2xl border border-zinc-900">
                        <h3 class="text-xs font-bold uppercase mb-4">Efici√™ncia de Fechamento (%)</h3>
                        <canvas id="chartPie"></canvas>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        let myChart1 = null, myChart2 = null;
        const SENHA_MASTER = "admin777";

        function validaLogin() {
            if(document.getElementById('loginPass').value === SENHA_MASTER) {
                document.getElementById('vendorLogin').style.display = 'none';
                document.getElementById('mainDashboard').style.display = 'flex';
                renderCRM();
            } else alert("Senha incorreta");
        }

        function salvarLead() {
            const l = {
                lead: document.getElementById('leadName').value,
                nicho: document.getElementById('leadNicho').value,
                protocolo: document.getElementById('leadProt').value,
                data: document.getElementById('leadDate').value,
                cota: document.getElementById('cotaType').value,
                status: 'AGENDADO',
                reuniao: 'Pendente' // Pendente, Realizada, No-Show, Reagendada
            };
            if(!l.lead || !l.protocolo) return;
            const leads = JSON.parse(localStorage.getItem('arxads_leads') || '[]');
            leads.unshift(l);
            localStorage.setItem('arxads_leads', JSON.stringify(leads));
            renderCRM();
        }

        function updateReuniao(prot, novoStatus) {
            const leads = JSON.parse(localStorage.getItem('arxads_leads') || '[]');
            const idx = leads.findIndex(l => l.protocolo === prot);
            leads[idx].reuniao = novoStatus;
            
            // Se marcar como Realizada ou No-Show, mas o status comercial mudar
            if(novoStatus === 'Realizada') {
                // Aqui voc√™ pode abrir o modal de fechamento ou apenas marcar
            }

            localStorage.setItem('arxads_leads', JSON.stringify(leads));
            renderCRM();
        }

        function renderCRM() {
            const leads = JSON.parse(localStorage.getItem('arxads_leads') || '[]');
            const body = document.getElementById('crmBody');
            body.innerHTML = leads.map(l => `
                <tr class="border-b border-zinc-900">
                    <td class="p-4 font-bold uppercase">${l.lead}<br><span class="text-[9px] text-zinc-600">${l.protocolo}</span></td>
                    <td class="p-4 text-gold text-[10px] uppercase font-bold">${l.nicho}</td>
                    <td class="p-4">
                        <select onchange="updateReuniao('${l.protocolo}', this.value)" class="bg-black border border-zinc-800 text-[10px] p-1 rounded">
                            <option value="Pendente" ${l.reuniao === 'Pendente' ? 'selected' : ''}>‚è≥ Pendente</option>
                            <option value="Realizada" ${l.reuniao === 'Realizada' ? 'selected' : ''}>‚úÖ Realizada</option>
                            <option value="No-Show" ${l.reuniao === 'No-Show' ? 'selected' : ''}>‚ùå No-Show</option>
                            <option value="Reagendada" ${l.reuniao === 'Reagendada' ? 'selected' : ''}>üîÑ Reagendada</option>
                        </select>
                    </td>
                    <td class="p-4">
                        <button onclick="window.activeLead='${l.protocolo}'; showSection('analytics')" class="text-[10px] text-zinc-500 underline">Detalhes</button>
                    </td>
                </tr>
            `).join('');
        }

        function renderAnalytics() {
            const leads = JSON.parse(localStorage.getItem('arxads_leads') || '[]');
            const total = leads.length;
            const realizadas = leads.filter(l => l.reuniao === 'Realizada').length;
            const noShow = leads.filter(l => l.reuniao === 'No-Show').length;
            const pendentes = leads.filter(l => l.reuniao === 'Pendente').length;
            const fechadas = leads.filter(l => l.status === 'FECHOU').length; // Supondo que status mude no fechamento

            document.getElementById('st-total').innerText = total;
            document.getElementById('st-vendas').innerText = fechadas;
            const taxa = total > 0 ? ((fechadas / total) * 100).toFixed(1) : 0;
            document.getElementById('st-taxa').innerText = taxa + "%";

            // Gr√°ficos
            if(myChart1) myChart1.destroy();
            if(myChart2) myChart2.destroy();

            const ctx1 = document.getElementById('chartStatus').getContext('2d');
            myChart1 = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: ['Pendente', 'Realizada', 'No-Show'],
                    datasets: [{
                        label: 'Qtd Reuni√µes',
                        data: [pendentes, realizadas, noShow],
                        backgroundColor: ['#555', '#FFD700', '#ff4444']
                    }]
                },
                options: { plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
            });

            const ctx2 = document.getElementById('chartPie').getContext('2d');
            myChart2 = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['Fechou', 'Perdido'],
                    datasets: [{
                        data: [fechadas, total - fechadas],
                        backgroundColor: ['#22c55e', '#111'],
                        borderColor: '#222'
                    }]
                }
            });
        }

        function showSection(id) {
            document.querySelectorAll('main section').forEach(s => s.classList.add('hidden'));
            document.getElementById('sec-' + id).classList.remove('hidden');
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            document.getElementById('nav-' + id).classList.add('active');
            if(id === 'analytics') renderAnalytics();
        }

        function abrirModoReuniao() {
            // Reaproveitar l√≥gica de PDF anterior...
            alert("Iniciando Modo Reuni√£o...");
        }
    </script>
</body>
</html>